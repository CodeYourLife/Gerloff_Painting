{% extends 'base.html' %}
{% load static %}
{% block nav_item_jobs %}active{% endblock nav_item_jobs %}
{% block content %}
{% load render_table from django_tables2 %}


<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <title>DataTables example - HTML (DOM) sourced data</title>
        <style type="text/css" class="init">

.colored-header th { background-color: lightblue; padding: 5px; border: solid 1px #777;}

.dataTables_wrapper {
    font-family: tahoma;
    font-size: 13px;
}

        nav .active, .collapsible:hover {
          background-color: Salmon;
        }
        .nav-pills a {
            color: black;
        }
        .nav-pills li {
            padding: 2px;
        }
        .nav-pills .active {
            background-color: #6c757d !important;
            padding: 5px;
        }
        label {
            margin-left: 10px;
            margin-right: 10px;
        }
        input {
            margin-left: 10px;
            margin-right: 10px;
            padding: 0.375rem 0.75rem;
            font-size: 1rem;
            line-height: 1.5;
            color: #495057;
            background-color: #fff;
            background-clip: padding-box;
            border: 1px solid #ced4da;
            border-radius: 0.25rem;
            transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
        }
        tr th {
            width: fit-content !important;
        }
        .tab-content * {
          color : black;
          background-color: white !important;
        }
        .active * {
            background-color: white !important;
        }
                .list-items {
        border-bottom: 1px solid black; display: flex; justify-content: space-between;
        }
        .text-wrap{
    white-space:normal;
}
.width-200{
    width:200px;
}
.dataTables_filter {
   float: left !important;
}
.tb { border-collapse: collapse; width:300px; }

.tb th, .tb td { padding: 5px; border: solid 1px #777; }
.tb th { background-color: lightblue; }

.table td {
        }

    </style>

    <link rel="shortcut icon" type="image/png" href="/media/images/favicon.png">
    <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://www.datatables.net/rss.xml">
    <link rel="stylesheet" type="text/css" href="/media/css/site-examples.css?_=8f7cff5ee7757412879aedf3efbfaee01">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.1/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="{% static 'project_styles.css' %}">

    <script type="text/javascript" src="/media/js/site.js?_=1d5abd169416a09a2b389885211721dd" data-domain="datatables.net" data-api="https://plausible.sprymedia.co.uk/api/event"></script>
	<script src="https://media.ethicalads.io/media/client/ethicalads.min.js"></script>
	<script type="text/javascript" src="/media/js/dynamic.php?comments-page=examples%2Fadvanced_init%2Fevents_live.html" async></script>
	<script type="text/javascript" src="/media/js/dynamic.php?comments-page=examples%2Fdata_sources%2Fdom.html" async></script>
	<script type="text/javascript" language="javascript" src="https://code.jquery.com/jquery-3.5.1.js"></script>
	<script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js"></script>
	<script type="text/javascript" language="javascript" src="../resources/demo.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.4/moment.min.js"></script>
    <script src="//cdn.datatables.net/plug-ins/1.13.7/sorting/datetime-moment.js"></script>
    <script type="text/javascript" class="init">

function new_filter_now(){
document.getElementById('filter_form').submit();
}

function add_new_note(){
var name=prompt("Job Note:");
if (name!=null){
document.getElementById("add_note").value = name
document.getElementById('new_note_form').submit();
}
}


function labor_done_changed(current_status){
if (labor_close_form.select_status.value == 'nothing_done' || labor_close_form.select_status.value == 'waiting_for_punchlist'){
if (current_status == "True"){alert("Sending email notification to Bridgette and Victor.  This may take a second so be patient")}
}
if (labor_close_form.select_status.value == 'done_done'){
alert("Sending email notification to Bridgette and Victor.  This may take a second so be patient")
}
document.getElementById('labor_close_form').submit();
}

function go_to_job(jobnumber){
url = "{% url 'job_page' 'ALL' %}"
url = url.replace('ALL', jobnumber);
window.location.href = url
}



function before_postpm(){
pmselect = change_client_pm_form.select_pm.value
newpm = change_client_pm_form.new_pm.value
if (pmselect == 'add_new'){
   if(newpm == ""){
     alert("You must type the new PM's name at least")
     return false
   }
}
if (pmselect == 'please_select'){
    alert("You must select a PM")
    return false
}
if (change_client_pm_form.pm_email.value == ""){
alert("The PM must have an email address")
return false
}
}
function before_postsuper(){
superselect = change_client_super_form.select_super.value
newsuper = change_client_super_form.new_super.value
if (superselect == 'add_new'){
   if(newsuper == ""){
     alert("You must type the new Super's name at least")
     return false
   }
}
}

function new_pm1(){
existingPM= "{{job.client_Pm.person_pk}}"
newPM = change_client_pm_form.select_pm.value
if (newPM == "add_new"){
    document.getElementById("show_new_pm").style.display = "block";
    document.getElementById("show_existing_pm").style.display = "none";
}

else if (existingPM != newPM){
    $.ajax({
    method: 'GET',
    url: '/superintendent/super_ajax',
    data: {'client_employee_id':change_client_pm_form.select_pm.value},
    success: function (data) {
    parsedData = JSON.parse(data);

    change_client_pm_form.pm_email.value = parsedData.email
    change_client_pm_form.pm_phone.value = parsedData.phone
    document.getElementById("show_new_pm").style.display = "none";
    document.getElementById("show_existing_pm").style.display = "block";
    }})
}
else {
     document.getElementById("show_new_pm").style.display = "none";
     document.getElementById("show_existing_pm").style.display = "block";
     change_client_pm_form.pm_email.value = "{{job.client_Pm.email}}"
    change_client_pm_form.pm_phone.value = "{{job.client_Pm.phone}}"
}
}
function new_super1(){
existingPM= "{{job.client_Super.person_pk}}"
newPM = change_client_super_form.select_super.value
if (newPM == "add_new"){
    document.getElementById("show_new_super").style.display = "block";
    document.getElementById("show_existing_super").style.display = "none";
}

else if (existingPM != newPM){
    $.ajax({
    method: 'GET',
    url: '/superintendent/super_ajax',
    data: {'client_employee_id':change_client_super_form.select_super.value},
    success: function (data) {
    parsedData = JSON.parse(data);

    change_client_super_form.super_email.value = parsedData.email
    change_client_super_form.super_phone.value = parsedData.phone
    document.getElementById("show_new_super").style.display = "none";
    document.getElementById("show_existing_super").style.display = "block";
    }})
}
else {
     document.getElementById("show_new_super").style.display = "none";
     document.getElementById("show_existing_super").style.display = "block";
     change_client_super_form.super_email.value = "{{job.client_Super.email}}"
    change_client_super_form.super_phone.value = "{{job.client_Super.phone}}"
}
}
$('#test_header').on('click', 'th', function () {
  var index = table.column(this).index();
  alert('index : '+index);
});

function change_client_pm(){

}
function change_client_super(){

}

function change_client(){

}
function showEmployeeData(status, client, client_email, client_phone,pm,superintendent,super_phone,super_email, pm_phone,pm_email) {
    document.getElementById("client_title").innerHTML = client;
    document.getElementById("client_pm_title").innerHTML = client;
    document.getElementById("client_super_title").innerHTML = client;
    document.getElementById("change_client_title").innerHTML = client;
    document.getElementById("change_client_pm_title").innerHTML = client;
    document.getElementById("change_client_super_title").innerHTML = client;
    let text = "<table border='1' class='table display'>";
    text += "<tr><td>Company: " + client + "</td></tr>";
    text += "<tr><td><a href='tel:+ " + client_phone + "'>Phone: " + client_phone + "</a></td></tr>";
                       text += "<tr><td><a href='mailto: " + client_email + "'>Email: " + client_email + "</a></td></tr>"
    text += "</table>"
    document.getElementById("client_info").innerHTML = text;
    text = "<table border='1' class='table display'>";
    text += "<tr><td>PM: " + pm + "</td></tr>";
    text += "<tr><td><a href='tel:+ " + pm_phone + "'>Phone: " + pm_phone + "</a></td></tr>";
    text += "<tr><td><a href='mailto: " + pm_email + "'>Email: " + pm_email + "</a></td></tr>";
    text += "</table>";
    document.getElementById("client_pm_info").innerHTML = text;
    text = "<table border='1' class='table display'>";
    text += "<tr><td>Superintendent: " + superintendent + "</td></tr>";
    text += "<tr><td><a href='tel:+ " + super_phone + "'>Phone: " + super_phone + "</a></td></tr>";
    text += "<tr><td><a href='mailto: " + super_email + "'>Email: " + super_email + "</a></td></tr>"
    text += "</table>"
    document.getElementById("client_super_info").innerHTML = text;

}

function anothertest(){
    $.ajax({
        method: 'GET',
        url: '/superintendent/super_ajax',
        data: {'job_number':pmform2.job_number.value, 'start_date': pmform2.start_date.value,'is_active':pmform2.is_active.checked,'notes':pmform2.date_note.value,'row':pmform2.row_number.value},
        success: function (data) {
            parsedData = JSON.parse(data);
            if (pmform2.row_number.value == "NO"){
                begin = document.getElementById("TEST_YO").innerHTML.search("</b>") + 7
                end = document.getElementById("TEST_YO").innerHTML.search("</a>")
                left = document.getElementById("TEST_YO").innerHTML.substring(0,begin)
                document.getElementById("TEST_YO").innerHTML = left + parsedData.new_date + "</a>"
                return;
            }
            table = document.getElementById("jobs_table");
            rows= table.rows;
            sorted = "true"
            for (i = 2; i < (rows.length - 1); i++) {
                greater = moment(table.rows[i].cells[2].innerHTML.substring(12,23),'MMM-DD-YYYY')
                lesser = moment(table.rows[i-1].cells[2].innerHTML.substring(12,23),'MMM-DD-YYYY')
                if (greater < lesser){
                    alert(greater)
                    alert(lesser)
                    sorted = "false";
                    break;
                }
            }
            var clicked_row = Number(pmform2.row_number.value)+1
            table.rows[clicked_row].cells[2].innerHTML = "<a href='#' >" + parsedData.new_date + "</a>"
            if (sorted == "false"){return}
            newdate =moment(table.rows[clicked_row].cells[2].innerHTML.substring(12,23),'MMM-DD-YYYY')
            for (i = 1; i < (rows.length - 1); i++) {
                if (i != pmform2.row_number.value){
                    existingdate = moment(table.rows[i].cells[2].innerHTML.substring(12,23),'MMM-DD-YYYY')
                    if (newdate > existingdate){break;}
                }
            }
            for (j = i; j < (rows.length - 1); j++) {
                if (j != pmform2.row_number.value){
                    existingdate = moment(table.rows[j].cells[2].innerHTML.substring(12,23),'MMM-DD-YYYY')
                    if (newdate < existingdate){break;}
                }
            }
            rows[clicked_row].parentNode.insertBefore(rows[clicked_row],rows[j]);
        }
    })
}
function submit_new_super(){
        $.ajax({
            method: 'GET',
            url: '/superintendent/super_ajax',
            data: {'job_number':pmform3.job_number.value, 'select_super':pmform3.select_super.value},
            success: function (data) {
           if (pmform3.row_number.value != "NO"){
                var table = $('#jobs_table').DataTable()
                table.cell(pmform3.row_number.value,4).data(pmform3.select_super.options[pmform3.select_super.selectedIndex].text)
            }
            else{
                begin = document.getElementById("TEST_BRO").innerHTML.search("</b>") + 6
                end = document.getElementById("TEST_BRO").innerHTML.search("</a>")
                left = document.getElementById("TEST_BRO").innerHTML.substring(0,begin)
                document.getElementById("TEST_BRO").innerHTML = left + pmform3.select_super.options[pmform3.select_super.selectedIndex].text + "</a>"
           }
           }
            })
}
function populate_super_modal(jobname,superid,jobnumber,firstname,x,origin){
    pmform3.select_super.value=superid
    if (origin == 1){
    var table = $('#jobs_table').DataTable()
    pmform3.row_number.value=table.row(x).index()
    }
    else{pmform3.row_number.value= "NO"}
    document.getElementById("title3").innerHTML = jobname
    pmform3.job_number.value=jobnumber
    pmform3.first_name.value=firstname
}

function populate_start_date_modal(jobnumber,jobname,startdate,is_active,x,origin){
    $.ajax({
        method: 'GET',
        url: '/superintendent/super_ajax',
        data: {'job_number':jobnumber,'build_notes': "True"},
        success: function (data) {
           parsedData = JSON.parse(data);
            let text = "<table border='1' class='table display'>"
            text += "<thead><tr><th>Date</th><th>User</th><th>Note</th></tr></thead>"

            parsedData.notes.forEach((element) => {
                text += "<tr><td>" + element.date + "</td><td>" + element.user + "</td><td>" + element.note + "</td></tr>";
            })
            text += "</table>"
            document.getElementById("notes_tab").innerHTML = text;
        }
    })

    var d = new Date(startdate),
        month = '' + (d.getMonth() + 1),
        day = '' + d.getDate(),
        year = d.getFullYear();
    if (month.length < 2)
        month = '0' + month;
    if (day.length < 2)
        day = '0' + day;
    adjusted_date=[year, month, day].join('-')
    document.getElementById("title2").innerHTML = jobname
    pmform2.date_note.value=""
    pmform2.start_date.value=adjusted_date
    if (origin == 1){
    var table = $('#jobs_table').DataTable()
    pmform2.row_number.value=table.row(x).index()
    }
    else {pmform2.row_number.value = "NO"}
    pmform2.job_number.value=jobnumber
    if (is_active == "True"){pmform2.is_active.checked = true}
    else{pmform2.is_active.checked = false}
}
function open_dropbox(jobnumber){
    $.ajax({
        method: 'GET',
        url: '/superintendent/super_ajax',
        data: {'dropbox': 'True','job_number':jobnumber},
        success: function (data) {window.open(data)}
        })
}
function open_dropbox2(jobnumber){
    $.ajax({
        method: 'GET',
        url: '/superintendent/super_ajax',
        data: {'dropbox': 'True','job_number':jobnumber},
        success: function (data) {


        document.getElementById("dropbox_link_hide").style.display = "block";
document.getElementById("dropbox_button_hide").style.display = "none";
var link = document.getElementById('link');
if (data == 'False'){link.innerHTML="REMOVED FROM DROPBOX"}
      else{

              link.setAttribute('href', data);
        link.click();
<!--document.getElementById("dropbox_button").action = data;-->
<!--document.getElementById('dropbox_button').submit();-->

}

        }
        })
}


window.onload = function() {
$.fn.dataTable.moment( 'MMM-DD-YYYY' );

var table = $('#jobs_table').DataTable({paging: false, aaSorting:[]})

var table = $('#notes_table').DataTable({paging: false})
var table = $('#subcontractors_table').DataTable({paging: false})
document.getElementById("show_new_pm").style.display = "none";
document.getElementById("show_new_super").style.display = "none";
if ('{{jobs}}' != 'ALL'){
document.getElementById("dropbox_link_hide").style.display = "none";
document.getElementById("dropbox_button_hide").style.display = "block";
}
};

    </script>


</head>
<body>
<nav class="sub-nav navbar navbar-expand-sm navbar-dark bg-dark">
    <a class="navbar-brand sub-navbar-brand" href="#">Active Jobs</a>
    <div id="navbarNavDropdown2">
        <ul class="sub-nav-list navbar-nav ">
            {% if jobs == 'ALL' %}
            <li><a class="nav-item nav-link active" href="#">Home</a></li>
            {% else %}
            {% for job in jobs %}
            <li><a class="nav-item nav-link active" href="#">{{job.job_name}}</a></li>
            {% endfor %}
            {% endif %}
             <li><a class="nav-item nav-link" href="{% url 'super_home' 'AUTO' %}">Superintendent View</a></li>
            <li><a class="nav-item nav-link" href="{% url 'book_new_job' %}">Book New Job</a></li>
        </ul>
    </div>
</nav>

<!-- Modal -->
<div class="modal fade" id="super-modal" tabindex="-1" role="dialog" aria-labelledby="title"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="title3"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="tab-content clearfix">
                    <div class="tab-pane active" id="1a">
                        <div style="margin-top: 12px" class="table-responsive">
                            <div id="date_tab2">
                                <form id="pmform3" action="{% url 'super_home' 'ALL' %}" method="post" >
                                {% csrf_token %}
                                <table>
                                    <tr><td>
                                        <label for="select_super">Select New Super:</label>
                                        <select id="select_super" name="select_super" >
                                                {% for super in supers %}
                                                <option value="{{super.id}}">{{super.first_name}} {{super.last_name}}</option>
                                                {% endfor %}
                                            </select>
                                    <br>
                                    <input type="hidden" name ="row_number" id="row_number" />
                                        <input type="hidden" name ="job_number" id="job_number" />
                                        <input type="hidden" id="first_name" />
                                        <button type="button" class="btn btn-primary" onclick = "submit_new_super()" data-dismiss="modal" > Save Changes </button>
                                </td></tr></table>
                                </form>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal fade" id="startdate-modal" tabindex="-1" role="dialog" aria-labelledby="title"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="title2"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <ul class="nav nav-pills">
                    <li class="nav-item"><a href="#7a" class="nav-link active" data-toggle="tab">Change Date</a></li>
                    <li class="nav-item"><a href="#8a" class="nav-link" data-toggle="tab">Notes</a></li>
                </ul>
                <div class="tab-content clearfix">
                    <div class="tab-pane active" id="7a">
                        <div style="margin-top: 12px" class="table-responsive">
                            <div id="date_tab">
                                <form id="pmform2" action="{% url 'super_home' 'ALL' %}" method="post" >
                                {% csrf_token %}
                                <table>
                                    <tr><td>
                                    Start date:<input type="date" id="start_date" name="start_date" value="1999-01-01">
                                    <br>
                                    <input type="checkbox" name ="is_active" id="is_active" checked /> <label for="is_active">Remove this job from Upcoming Jobs List </label>
                                    <input type="hidden" name ="row_number" id="row_number" />
                                        <input type="hidden" name ="job_number" id="job_number" />
                                        <br>
                                    Explain This Change:<br>
                                    <textarea id="date_note" name="date_note" class="form-control" style="min-width: 100%"></textarea>
                                    <br>

                                </td></tr></table>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="8a">
                        <div style="margin-top: 12px" class="table-responsive">
                            <div id="notes_tab">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick = "anothertest()" data-dismiss="modal" > Save Changes </button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>
{% if jobs == 'ALL' %}
<form class="form-control form-control-sm" id="filter_form" method="get">
    <div class="container">
        <div class="form-group">
            <label for="search2" >Super:</label>
            <select id="search2" class="form-control" name="search2" onchange="new_filter_now()">
            {% if search2_exists %}
            {% if search2_exists == 'ALL' %}
                <option value="ALL">"All"</option>
                <option value="UNASSIGNED">"UNASSIGNED"</option>
            {% elif search2_exists == 'UNASSIGNED' %}
                <option value="UNASSIGNED">"UNASSIGNED"</option>
                <option value="ALL">"All"</option>
            {% else %}
                <option value={{search2_exists}}>{{selected_supername}}</option>
                <option value="ALL">"All"</option>
                <option value="UNASSIGNED">"UNASSIGNED"</option>
            {% endif %}
            {% else %}
            <option value="ALL">"All"</option>
            <option value="UNASSIGNED">"UNASSIGNED"</option>
            {% endif %}
            {% if supers %}
            {% for super in supers %}
            <option value="{{super.id}}">{{super.first_name}} {{super.last_name}}</option>
            {% endfor %}
            {% endif %}
            </select>
        </div>

        <div class="form-check">
        <input type="checkbox" class="form-check-input" id="search3" name="search3"  {% if search3_exists %} checked {% endif %}  onchange="new_filter_now()" />
        <label for="search3" class="form-check-label">Include Closed Jobs</label>
        </div>
        <div class="form-check">
            <input type="checkbox" class="form-check-input" id="search7" name="search7" {% if search7_exists %} checked {% endif %} onchange="new_filter_now()">
            <label class="form-check-label" for="search7">Show Only Jobs That Are Done</label>
        </div>
        </div>
    </form>

<div class="table-responsive">
    <table id="jobs_table" class="display table table-sm">
        <thead>
        <tr>
            <th scope="col">Job #</th>
            <th scope="col">Job Name</th>
            <th id="test_header" scope="col">Start Date</th>
            <th scope="col">Client</th>
            <th scope="col">Super</th>
            <th scope="col">Contract Amount</th>
        </tr>
        </thead>
        <tbody>
        {% for x in jobstable %}
        {% if x.is_labor_done == True %}
            <tr style="background-color:hsla(0,0%, 32%);" onclick="populate_job_data('{{x.job_number}}','{{x.job_name}}','{{x.start_date}}','{{x.is_active}}',this)">
 {% elif x.is_waiting_for_punchlist == True %}
                <tr style="background-color:hsla(0,0%, 65%);" onclick="populate_job_data('{{x.job_number}}','{{x.job_name}}','{{x.start_date}}','{{x.is_active}}',this)">
                {% else %}
            <tr onclick="populate_job_data('{{x.job_number}}','{{x.job_name}}','{{x.start_date}}','{{x.is_active}}',this)">
            {% endif %}
                <td style="white-space: nowrap;" width = "20px" onclick="go_to_job('{{x.job_number}}')"><a href="#">{{x.job_number}}</a></td>
                <td style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 250px"  onclick="go_to_job('{{x.job_number}}')"><a href="#">{% if x.is_labor_done == True %}<b>[DONE]</b>{% elif x.is_waiting_for_punchlist == True %}<b>[PUNCH]</b>{% endif %} {{x.job_name}}</a></td>
                <td style="white-space:nowrap" data-toggle="modal" data-target="#startdate-modal" onclick="populate_start_date_modal('{{x.job_number}}','{{x.job_name}}','{{x.start_date}}','{{x.is_active}}',this,1)"><a href="#">{{x.start_date|date:'M-d-Y'}}</a></td>
                <td style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 150px" >{{x.client}}</td>

                <td data-toggle="modal" data-target="#super-modal" onclick="populate_super_modal('{{x.job_name}}','{{x.superintendent.id}}','{{x.job_number}}','{{x.superintendent.first_name}}',this,1)"><a href="#">{{x.superintendent.first_name}}</a></td>
                <td>{{x.contract_amount}}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

</div>
{% else %}



<!-- Modal -->
<div class="modal fade" id="labor_close-modal" tabindex="-1" role="dialog" aria-labelledby="title"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="labor_close_title">Close Job</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="labor_close_form" action="{% url 'job_page' jobnumber=job.job_number %}" method="post" >
                                {% csrf_token %}
                                <table>
                                    <tr><td>
                                        <label for="select_status">Select Status:</label>
                                        <select id="select_status" name="select_status" >
                                            {% if job.is_labor_done == True %}
                                                <option value="nothing_done">Labor is Not Complete</option>
                                                <option value="waiting_for_punchlist">Waiting For Punchlist</option>
                                            {% elif job.is_waiting_for_punchlist == True %}
                                                <option value="nothing_done">Labor is Not Complete</option>
                                                <option value="done_done">Labor is 100% Complete</option>
                                            {% else %}
                                                <option value="waiting_for_punchlist">Waiting For Punchlist</option>
                                                <option value="done_done">Labor is 100% Complete</option>
                                            {% endif %}
                                            </select>
                                    <br>
                                    </td>
                                        </tr>
                                    <tr><td>                                        <br>
                                    Explain This Change:<br>
                                    <textarea id="closed_note" name="closed_note" class="form-control" style="min-width: 100%"></textarea></td></tr>
                                    </table>
</form>
                            </div>

            <div class="modal-footer">
                <button onclick = "labor_done_changed('{{job.is_labor_done}}')" class="btn btn-primary" data-dismiss="modal"> SAVE </button>
<!--                <input type="submit" name="submit_labor_close" class="btn btn-danger" value="SAVE" />-->
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>

            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="client_pm-modal" tabindex="-1" role="dialog" aria-labelledby="title"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="client_pm_title"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                        <div style="margin-top: 12px" class="table-responsive">
                            <div id="client_pm_info">
                            </div>
                        </div>
                <button onclick = "change_client_pm()" class="btn btn-primary" data-toggle="modal" data-target="#change_client_pm-modal" data-dismiss="modal"> Change PM Information </button>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal fade" id="client_super-modal" tabindex="-1" role="dialog" aria-labelledby="title"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="client_super_title"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                        <div style="margin-top: 12px" class="table-responsive">
                            <div id="client_super_info">
                            </div>
                        </div>
                <button onclick = "change_client_super()" class="btn btn-primary" data-toggle="modal" data-target="#change_client_super-modal" data-dismiss="modal"> Change Super Information </button>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal fade" id="client-modal" tabindex="-1" role="dialog" aria-labelledby="title"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="client_title"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                        <div style="margin-top: 12px" class="table-responsive">
                            <div id="client_info">
                            </div>
                        </div>
                <button onclick = "change_client()" class="btn btn-primary" data-toggle="modal" data-target="#change_client-modal" data-dismiss="modal"> Change Client Information </button>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal fade" id="change_client_pm-modal" tabindex="-1" role="dialog" aria-labelledby="title"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="change_client_pm_title">Update information </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div style="margin-top: 12px" class="table-responsive">
                    <div id="change_client_pm_info">
                     <form id="change_client_pm_form" action="{% url 'job_page' job.job_number %}" method="post" onSubmit="return before_postpm()">
                    {% csrf_token %}
                        <table>
                            <tr><td>
                                <label for="select_pm">Change PM</label>
                                 <select id="select_pm" name="select_pm" onchange="new_pm1()">
                                {% if job.client_Pm %}
                                <option value={{job.client_Pm.person_pk}}>{{job.client_Pm.name}}</option>
                                {% else %}
                                <option value="please_select">Please Select</option>
                                {% endif %}
                                <option value="add_new">Add New</option>
                                {% if client_employees %}
                                {% for employee in client_employees %}
                                <option value={{employee.person_pk}}>{{employee.name}}</option>
                                {% endfor %}
                                {% endif %}
                                </select>
                            </td></tr>
                        </table>
                        <table id="show_new_pm">
                            <tr><td>New Person: <input type= "text" name="new_pm" id="new_pm" placeholder="Name" size="30" /></td></tr>
                            <tr><td>Email: <input type= "text" name="new_pm_email" id="new_pm_email" placeholder="Email" size="30" /></td></tr>
                            <tr><td>Phone: <input type= "text" name="new_pm_phone" id="new_pm_phone" placeholder="Phone" size="30" /></td></tr>
                        </table>
                        <table id="show_existing_pm">
                            <tr><td>Email: <input type= "text" name="pm_email" id="pm_email" {% if job.client_Pm.email %}value='{{job.client_Pm.email}}' {% else %} placeholder="Email" {% endif %} size="30" /></td></tr>
                            <tr><td>Phone: <input type= "text" name="pm_phone" id="pm_phone" {% if job.client_Pm.phone %}value='{{job.client_Pm.phone}}' {% else %} placeholder="Main Phone" {% endif %} size="30" /></td></tr>
                        </table>
                        <table><tr><td><input type="submit" name="submit_pm" class="btn btn-danger" value="Save Changes to PM" /></td></tr></table>
                     </form>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close without Saving</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="change_client_super-modal" tabindex="-1" role="dialog" aria-labelledby="title"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="change_client_super_title">Update information </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                        <div style="margin-top: 12px" class="table-responsive">
                            <div id="change_client_super_info">
                                <form id="change_client_super_form" action="{% url 'job_page' job.job_number %}" method="post" onSubmit="return before_postsuper()">
                                    {% csrf_token %}
                                    <table>
                                        <tr><td>
                                            <label for="select_super">Change Super</label>
                                            <select id="select_super" name="select_super" onchange="new_super1()">
                                            {% if job.client_Super %}
                                            <option value={{job.client_Super.person_pk}}>{{job.client_Super.name}}</option>
                                            {% endif %}
                                            <option value="not_sure">Not Sure</option>
                                            <option value="add_new">Add New</option>
                                            {% if client_employees %}
                                            {% for employee in client_employees %}
                                            <option value={{employee.person_pk}}>{{employee.name}}</option>
                                            {% endfor %}
                                            {% endif %}
                                            </select>
                                        </td></tr>
                                    </table>
                                    <table id="show_new_super">
                                        <tr><td>New Person: <input type= "text" name="new_super" id="new_super" placeholder="Name" size="30" /></td></tr>
                                        <tr><td>Email: <input type= "text" name="new_super_email" id="new_super_email" placeholder="Email" size="30" /></td></tr>
                                        <tr><td>Phone: <input type= "text" name="new_super_phone" id="new_super_phone" placeholder="Phone" size="30" /></td></tr>
                                    </table>
                                    <table id="show_existing_super">
                                        <tr><td>Email: <input type= "text" name="super_email" id="super_email" {% if job.client_Super.email %}value='{{job.client_Super.email}}' {% else %} placeholder="Email" {% endif %} size="30" /></td></tr>
                                        <tr><td>Phone: <input type= "text" name="super_phone" id="super_phone" {% if job.client_Super.phone %}value='{{job.client_Super.phone}}' {% else %} placeholder="Main Phone" {% endif %} size="30"  /></td></tr>
                                    </table>
                                     <table><tr><td><input type="submit" name="submit_super" class="btn btn-danger" value="Save Changes to Super" /></td></tr></table>
                                 </form>
                            </div>
                        </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close without Saving</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="change_client-modal" tabindex="-1" role="dialog" aria-labelledby="title"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="change_client_title">Update information </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                        <div style="margin-top: 12px" class="table-responsive">
                            <div id="change_client_info">
                                 <form id="change_client_form" action="{% url 'job_page' job.job_number %}" method="post" >
                                    {% csrf_token %}
                                    <table>
                                        <tr><td>Company Email: <input type= "text" name="client_bid_email" id="client_bid_email" {% if job.client.bid_email %}value='{{job.client.bid_email}}' {% else %} placeholder="Email" {% endif %} size="30" /></td></tr>
                                        <tr><td>Main Phone: <input type= "text" name="client_phone" id="client_phone" {% if job.client.phone %}value='{{job.client.phone}}' {% else %} placeholder="Main Phone" {% endif %} size="30" /></td></tr>
                                    </table>
                                    <table><tr><td><input type="submit" name="submit_client" class="btn btn-danger" value="Save Changes to Client" /></td></tr></table>
                                 </form>
                            </div>
                        </div>
                    </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close without Saving</button>
            </div>
        </div>
    </div>
</div>


<div style="margin-left: 12px; margin-right: 12px;">
    <div class="row">
        <div class="col-sm-4 list-items"><b>Job Name:</b> {{job.job_name}}</div>
        <div class="col-sm-4 list-items"><b>Job Number:</b> {{job.job_number}}</div>
        <div class="col-sm-4 list-items"><b>Address:</b> {{job.address}} {{job.city}} {{job.state}}</div>
    </div>
    <div class="row">

        <div class="col-sm-4 list-items" data-toggle="modal" data-target="#client-modal"><b>Client:</b> <a href ="#" onclick="showEmployeeData( 'CLIENT','{{ job.client }}', '{{ job.client.bid_email }}','{{ job.client.phone }}', '{{ job.client_Pm }}', '{{ job.client_Super }}', '{{ job.client_Super.phone }}', '{{ job.client_Super.email }}', '{{ job.client_Pm.phone }}', '{{ job.client_Pm.email }}');">{{job.client}}</a></div>
        <div class="col-sm-4 list-items" data-toggle="modal" data-target="#client_pm-modal"><b>GC PM:</b> <a href ="#" onclick="showEmployeeData('PM',  '{{ job.client }}', '{{ job.client.bid_email }}','{{ job.client.phone }}', '{{ job.client_Pm }}', '{{ job.client_Super }}', '{{ job.client_Super.phone }}', '{{ job.client_Super.email }}', '{{ job.client_Pm.phone }}', '{{ job.client_Pm.email }}');">{{job.client_Pm}}</a></div>
        <div class="col-sm-4 list-items" data-toggle="modal" data-target="#client_super-modal"><b>GC Super:</b> <a href ="#" onclick="showEmployeeData( 'SUPERINTENDENT','{{ job.client }}', '{{ job.client.bid_email }}','{{ job.client.phone }}', '{{ job.client_Pm }}', '{{ job.client_Super }}', '{{ job.client_Super.phone }}', '{{ job.client_Super.email }}', '{{ job.client_Pm.phone }}', '{{ job.client_Pm.email }}');">{{job.client_Super}}</a></div>
    </div>

    <div class="row">
        <div class="col-sm-4 list-items" id="TEST_YO" data-toggle="modal" data-target="#startdate-modal"><b>Start Date:</b><a href ="#" onclick="populate_start_date_modal('{{job.job_number}}','{{job.job_name}}','{{job.start_date}}','{{job.is_active}}',this,2)">{{job.start_date}}</a></div>
        <div class="col-sm-4 list-items" id="TEST_BRO" data-toggle="modal" data-target="#super-modal" ><b>Gerloff Super:</b><a href = "#" onclick="populate_super_modal('{{job.job_name}}','{{job.superintendent.id}}','{{job.job_number}}','{{job.superintendent.first_name}}',this,2)">{{job.superintendent}}</a></div>
        <div class="col-sm-4 list-items"><b>Gerloff Estimator:</b> {{job.estimator}}</div>
    </div>
    <div class="row">
        <div class="col-sm-4 list-items">
            <b>Contract Amount:</b> {% if job.is_t_m_job == True %} T&M {% else %}
            {{job.contract_amount}}{% endif %}
        </div>
        <div class="col-sm-8 list-items">
        </div>
    </div>

    <div style=" padding-top: 12px;" class="row">
        <div  class="col-12" style="display: flex">
            <div style="flex-grow: 1"></div>
            <form action="{% url 'update_job_info' job.job_number %}"><input type="submit" class="btn btn-info btn-sm"
                                                                             value="Update Job Information"/></form>
        </div>
    </div>
    <hr>


    <div class="row h-100 d-flex align-items-center">
        <div style="margin: 5px;" class="col-sm-3">
            <form action="{% url 'change_order_new' job.job_number %}"><input type="submit" class="btn btn-primary btn-sm" value="New Change Order"/>
            </form>
        </div>
        <div style="margin: 5px;" class="col-sm-3">
            <form action="{% url 'request_pickup' jobnumber=job.job_number item='ALL' pickup='ALL' status='ALL' %}"><input type="submit" class="btn btn-primary btn-sm" value="Request Equipment Pickup"/>
            </form>
        </div>
        <div style="margin: 5px;" class="col-sm-3">
    {% if job.is_waiting_for_punchlist == True %}
        {% if job.is_labor_done == True %}
                <input class="btn btn-dark btn-sm" data-toggle="modal" data-target="#labor_close-modal" value="RLabor was done  {{job.labor_done_Date}}" />
            {% else %}
                            <input class="btn btn-danger btn-sm" data-toggle="modal" data-target="#labor_close-modal" value="Waiting for Punchlist" />
         {% endif %}
    {% else %}
        {% if job.is_labor_done == True %}
                            <input class="btn btn-dark btn-sm" data-toggle="modal" data-target="#labor_close-modal" value="Labor was done  {{job.labor_done_Date}}" />
        {% else %}
                            <input style="width: 245px" class="btn btn-success btn-sm" data-toggle="modal" data-target="#labor_close-modal" value="Click Here to Mark Labor Complete" />
        {% endif %}
    {% endif %}

        </div>
        <div style="margin: 5px;" class="col-sm-3">
            <div id="dropbox_button_hide">
             <form id="dropbox_button" action="{% url 'job_page' job.job_number %}" target="_blank" >
                <input type="button" class="btn btn-warning btn-sm"  onclick = "open_dropbox2('{{job.job_number}}')" value="Plans & Work Order" />

             </form>
            </div>
            <div style="margin-top: 5px; margin-bottom: 5px;">
                <form id="" action="" target="_blank" >
                    <input type="button" class="btn btn-primary btn-sm"  onclick = "" value="Add Painter" />
                 </form>
            </div>
            <div id="dropbox_link_hide"><a id="link" href="#" target="_blank"><b>CLICK HERE FOR PLANS!</b></a></div>
        </div>
    </div>
</div>


    <div class="card">
        <div class="card-header" id="headingOne">
            <h5 class="mb-0">
                <button class="btn btn-link" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false"
                        aria-controls="collapseOne">
                    Job Notes
                </button>
            </h5>
        </div>
        <div id="collapseOne" class="collapse hide" aria-labelledby="headingOne" data-parent="#accordion">
            <div class="card-body">
                <div class="row">
                    <div class="col">

                        <form id=new_note_form action="{% url 'job_page' job.job_number %}" method="post">
                            {% csrf_token %}
                          <br>
                <input type="hidden" name="add_note" id="add_note" value="" />
                            <button type="button" class="btn btn-primary" onclick = "add_new_note()" >ADD NEW NOTE</button>
                        </form>

                    </div>
                </div>
                <div class="content">
                    <form style="padding-top: 24px" method="get">
                        <div class="row">
                            <div class="col-sm-2">
                                {% if admin %}
                                Admin<input type="checkbox" name="admin" checked/>
                                {% else %}
                                Admin<input type="checkbox" name="admin"/>
                                {% endif %}
                            </div>
                            <div class="col-sm-2">
                                {% if start %}
                                Start<input type="checkbox" name="start" checked/>
                                {% else %}
                                Start<input type="checkbox" name="start"/>
                                {% endif %}
                            </div>
                            <div class="col-sm-2">
                                {% if field %}
                                Field<input type="checkbox" name="field" checked/>
                                {% else %}
                                Field<input type="checkbox" name="field"/>
                                {% endif %}
                            </div>
                            <div class="col-sm-2">
                                {% if change_order %}
                                Change Order<input type="checkbox" name="change_order" checked/>
                                {% else %}
                                Change Order<input type="checkbox" name="change_order"/>
                                {% endif %}
                            </div>
                            <div class="col-sm-2">
                                {% if submittal %}
                                Submittal<input type="checkbox" name="submittal" checked/>
                                {% else %}
                                Submittal<input type="checkbox" name="submittal"/>
                                {% endif %}
                            </div>
                            <div class="col-sm-2">
                                <input type="submit" value="Filter"/>
                            </div>
                        </div>
                    </form>


                    <div class="table-responsive">
                        <table id="notes_table" class="display table table-sm">
                            <thead class="colored-header">
                            <tr>
                                <th scope="col">By</th>
                                <th scope="col">Date</th>
                                <th scope="col">Note</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% if notes %}
                            {% for x in notes %}
                            <tr>
                                <td>{{x.user}}</td>
                                <td>{{x.date}}</td>
                                <td><div class='text-wrap width-400'>{{x.note}}</div></td>
                            </tr>
                            {% endfor %}
                            {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>



{% if tickets %}
    <div class="card">
        <div class="card-header" id="headingTwo">
            <h5 class="mb-0">
                <button class="btn btn-link" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false"
                        aria-controls="collapseTwo">
                    Outstanding Extra Work Tickets
                </button>
            </h5>
        </div>
        <div id="collapseTwo" class="collapse hide" aria-labelledby="headingTwo" data-parent="#accordion">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="tickets_table" class="display table">
                        <thead class="colored-header">

                        <tr>
                            <th>CO#</th>
                            <th>Description</th>
                            <th>Notes</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for ticket in tickets %}
                        <tr>
                            <td><a href="{% url 'extra_work_ticket' ticket.id %}">{{ticket.cop_number}}</a></td>
                            <td>{{ticket.description}}</td>
                            <td>{{ticket.notes}}</td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
{% endif %}

{% if open_cos %}
    <div class="card">
        <div class="card-header" id="headingThree">
            <h5 class="mb-0">
                <button class="btn btn-link" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false"
                        aria-controls="collapseThree">
                    Pending Change Orders Not Approved Yet
                </button>
            </h5>
        </div>
        <div id="collapseThree" class="collapse hide" aria-labelledby="headingThree" data-parent="#accordion">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="tickets_table1" class="display table">
                        <thead class="colored-header">

                        <tr>
                            <th>CO#</th>
                            <th>Description</th>
                            <th>Notes</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for open_co in open_cos %}
                        <tr>
                            <td><a href="{% url 'extra_work_ticket' open_co.id %}">{{open_co.cop_number}}</a></td>
                            <td>{{open_co.description}}</td>
                            <td>{{open_co.notes}}</td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
{% endif %}

{% if approved_cos %}
    <div class="card">
        <div class="card-header" id="headingFour">
            <h5 class="mb-0">
                <button class="btn btn-link" data-toggle="collapse" data-target="#collapseFour" aria-expanded="false"
                        aria-controls="collapseFour">
                    Approved Change Orders
                </button>
            </h5>
        </div>
        <div id="collapseFour" class="collapse hide" aria-labelledby="headingFour" data-parent="#accordion">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="tickets_table2" class="display table">
                        <thead class="colored-header">

                        <tr>
                            <th>CO#</th>
                            <th>Description</th>
                            <th>Notes</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for approved_co in approved_cos %}
                        <tr>
                            <td>{{approved_co.cop_number}}</td>
                            <td>{{approved_co.description}}</td>
                            <td>{{approved_co.notes}}</td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
{% endif %}

{% if equipments %}
    <div class="card">
        <div class="card-header" id="headingFive">
            <h5 class="mb-0">
                <button class="btn btn-link" data-toggle="collapse" data-target="#collapseFive" aria-expanded="false"
                        aria-controls="collapseFive">
                    Equipment
                </button>
            </h5>
        </div>
        <div id="collapseFive" class="collapse hide" aria-labelledby="headingFive" data-parent="#accordion">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="tickets_table3" class="display table">
                        <thead class="colored-header">


                        <tr>
                            <th>Type</th>
                            <th>Item</th>
                            <th>Notes</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for equipment in equipments %}
                        <tr>
                            <td>{{equipment.inventory_type}}</td>
                            <td><a href="{% url 'equipment_page' equipment.id %}">{{equipment.item}}</a></td>
                            <td>{{equipment.notes}}</td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
{% endif %}

{% if rentals %}
    <div class="card">
        <div class="card-header" id="headingSix">
            <h5 class="mb-0">
                <button class="btn btn-link" data-toggle="collapse" data-target="#collapseSix" aria-expanded="false"
                        aria-controls="collapseSix">
                    Rentals
                </button>
            </h5>
        </div>
        <div id="collapseSix" class="collapse hide" aria-labelledby="headingSix" data-parent="#accordion">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="tickets_table4" class="display table">
                        <thead class="colored-header">

                        <tr>
                            <th>Item</th>
                            <th>On Rent Date</th>
                            <th>Notes</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for rental in rentals %}
                        <tr>
                            <td><a href="{% url 'rental_page' rental.id 'YES' %}">
                                <div style="height:100%;width:100%">
                                    {{rental.item}}
                                </div>
                            </a></td>
                            <td>{{rental.on_rent_date}}</td>
                            <td>{{rental.notes}}</td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
{% endif %}

{% if wc_not_ordereds %}
    <div class="card">
        <div class="card-header" id="headingSeven">
            <h5 class="mb-0">
                <button class="btn btn-link" data-toggle="collapse" data-target="#collapseSeven" aria-expanded="false"
                        aria-controls="collapseSeven">
                    Wallcovering Not Ordered
                </button>
            </h5>
        </div>
        <div id="collapseSeven" class="collapse hide" aria-labelledby="headingSeven" data-parent="#accordion">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="tickets_table5" class="display table">
                        <thead class="colored-header">

                        <tr>
                            <th>Code</th>
                            <th>Vendor</th>
                            <th>Pattern</th>
                            <th>Notes</th>
                        </tr>
                        </thead>
                        <tbody>c
                        {% for wc_not_ordered in wc_not_ordereds %}
                        <tr>
                            <td>{{wc_not_ordered.code}}</td>
                            <td>{{wc_not_ordered.vendor.company_name}}</td>
                            <td>{{wc_not_ordered.pattern}}</td>
                            <td>{{wc_not_ordered.notes}}</td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
{% endif %}

{% if wc_ordereds %}
    <div class="card">
        <div class="card-header" id="headingEight">
            <h5 class="mb-0">
                <button class="btn btn-link" data-toggle="collapse" data-target="#collapseEight" aria-expanded="false"
                        aria-controls="collapseEight">
                    Wallcovering Ordered But Not Received
                </button>
            </h5>
        </div>
        <div id="collapseEight" class="collapse hide" aria-labelledby="headingEight" data-parent="#accordion">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="tickets_table6" class="display table">
                        <thead class="colored-header">

                        <tr>
                            <th>Description</th>
                            <th>Date Ordered</th>
                            <th>Notes</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for wc_ordered in wc_ordereds %}
                        <tr>
                            <td>{{wc_ordered.item_description}}</td>
                            <td>{{wc_ordered.order.date_ordered}}</td>
                            <td>{{wc_ordered.order.notes}}</td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
{% endif %}

{% if packages %}
    <div class="card">
        <div class="card-header" id="headingNine">
            <h5 class="mb-0">
                <button class="btn btn-link" data-toggle="collapse" data-target="#collapseNine" aria-expanded="false"
                        aria-controls="collapseNine">
                    Received Wallcovering
                </button>
            </h5>
        </div>
        <div id="collapseNine" class="collapse hide" aria-labelledby="headingNine" data-parent="#accordion">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="tickets_table7" class="display table">
                        <thead class="colored-header">

                        <tr>
                            <th>Description</th>
                            <th>Quantity</th>
                            <th>Notes</th>
                            <th>Sent to Job</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for package in packages %}
                        <tr>
                            <td>{{package.description}}
                                {% if package.order_item1.wallcovering.code != None %}
                                {{package.order_item1.wallcovering.code}} {{package.qnty_item1}} {{package.unit_item1}}
                                {% endif %}
                                {{package.order_item2.wallcovering.code}} {{package.qnty_item2}} {{package.unit_item2}}
                                {% if package.order_item3.wallcovering.code != None %}
                                {{package.order_item3.wallcovering.code}} {{package.qnty_item3}} {{package.unit_item3}}
                                {% endif %}
                                {% if package.order_item4.wallcovering.code != None %}
                                {{package.order_item4.wallcovering.code}} {{package.qnty_item4}} {{package.unit_item4}}
                                {% endif %}
                                {% if package.order_item5.wallcovering.code != None %}
                                {{package.order_item5.wallcovering.code}} {{package.qnty_item5}} {{package.unit_item5}}
                                {% endif %}
                            </td>
                            <td>{{package.quantity_received}} {{package.unit}}</td>
                            <td>{{package.notes}}</td>
                            <td>
                                {% if deliveries %}
                                {% for delivery in deliveries %}

                                {% if delivery.package == package %}
                                {{delivery.description}} {{delivery.quantity_sent}} {{delivery.outgoing_event.date}}
                                {% endif %}

                                {% endfor %}
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
{% endif %}


{% if submittals %}
    <div class="card">
        <div class="card-header" id="headingTen>
            <h5 class="mb-0">
                <button class="btn btn-link" data-toggle="collapse" data-target="#collapseTen" aria-expanded="false"
                        aria-controls="collapseTen">
                    Submittals
                </button>
            </h5>
        </div>
        <div id="collapseTen" class="collapse hide" aria-labelledby="headingTen" data-parent="#accordion">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="tickets_table8" class="display table">
                        <thead class="colored-header">

                        <tr>
                            <th>#</th>
                            <th>Description</th>
                            <th>Date Sent</th>
                            <th>Date Returned</th>
                            <th>Notes</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for submittal in submittals %}
                        <tr>
                            <td>{{submittal.submittal_number}}</td>
                            <td>{{submittal.description}}</td>
                            <td>{{submittal.date_sent}}</td>
                            <td>{{submittal.date_returned}}</td>
                            <td>{{submittal.notes}}</td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
{% endif %}

{% if subcontracts %}
    <div class="card">
        <div class="card-header" id="headingNine">
            <h5 class="mb-0">
                <button class="btn btn-link" data-toggle="collapse" data-target="#collapseNine" aria-expanded="false"
                        aria-controls="collapseENine">
                    Subcontractors
                </button>
            </h5>
        </div>
        <div id="collapseNine" class="collapse hide" aria-labelledby="headingNine" data-parent="#accordion">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="subcontractors_table" class="display table table-sm">
                        <thead class="colored-header">

                        <tr>
                            <th scope="col" >PO #</th>
                            <th scope="col" >Company</th>
                            <th scope="col" >Total Amt.</th>
                            <th scope="col" >% Complete</th>

                        </tr>
                        </thead>
                        <tbody>
                        {% for subcontract in subcontracts %}
                        <tr>
                            {% if subcontract.po_number %}
                            <td><a href="{% url 'subcontract' subcontract.id %}" >{{subcontract.po_number}}</a></td>
                            {% else %}
                            <td><a href="{% url 'subcontract' subcontract.id %}" >TBD</a></td>
                            {% endif %}
                            <td>{{subcontract.subcontractor}}</td>
                            <td>${{subcontract.total_contract}}</td>
                            <td>{{subcontract.percent_complete}}</td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
{% endif %}


<script>
    var coll = document.getElementsByClassName("collapsible");
    var i;

    for (i = 0; i < coll.length; i++) {
      coll[i].addEventListener("click", function() {
        this.classList.toggle("active");
        var content = this.nextElementSibling;
        if (content.style.display === "block") {
          content.style.display = "none";
        } else {
          content.style.display = "block";
        }
      });
    }
</script>

</body>
</html>

{% endblock %}
