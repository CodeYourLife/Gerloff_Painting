<!DOCTYPE html>
{% load static %}
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="{% static 'signature.js' %}"></script>
<!--    <script src="/static/signature.js"></script>-->
<!--<script src="/static/signature.js?v=999"></script>-->

<!--    <script type="text/javascript" class="init">-->
<!--<script src="{% static 'changeorder/static/signature.js' %}"></script>-->
<!--<script src="{% static 'changeorder/signature.js' %}"></script>-->
    <link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
  integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N"
  crossorigin="anonymous">
<style>
    #final_button {
    background-color: #dc3545;
    border-color: #dc3545;
}

    table, td, th {
      border: 1px solid #ddd;
      text-align: left;
    }

    table {
      border-collapse: collapse;
      width: 100%;
    }

    th, td {
      padding: 5px;
    }

    /* ===== Signature block ===== */
    .signature-wrapper {
        margin-top: 16px;
        margin-bottom: 20px;
    }

    #newSignature {
        width: 500px;
        height: 200px;
        max-width: 100%;
        border: 2px solid #444;
        background: #fff;
        touch-action: none;
    }

    /* Mobile */
    @media (max-width: 768px) {
        #newSignature {
            width: 100%;
            height: 220px;
        }
    }

    /* Comments box */
    #gc_notes {
        width: 100%;
        max-width: 400px;
        padding: 8px;
        margin-top: 6px;
        border: 2px solid #999;
        border-radius: 4px;
        font-size: 16px;
        box-sizing: border-box;
        background-color: #fafafa;
    }
</style>
</head>
<body style="margin: 22px; font-family: Helvetica">
<H2>Gerloff Painting Extra Work Ticket</H2>
<div style="width: 100%; display:flex; justify-content: space-between;">
    <div style="word-wrap: break-word;"><b>Job:</b>&nbsp;{{changeorder.job_number}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>Change Order #</b>&nbsp;{{changeorder.cop_number}} - {{changeorder.description}}</div>
</div>
<div style="width: 100%; display:flex; justify-content: space-between;">
<div style="word-wrap: break-word;"><b>Week Ending Date:</b>&nbsp;{{ewt.week_ending}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>Ticket Completed By:</b>&nbsp;{{ewt.completed_by}}
</div>
</div>
<div style="width: 100%;"><p><b>Work Description:</b>&nbsp;{{ewt.notes}}</p></div>
<div style="margin-top: 12px; margin-bottom: 12px;">
<table style="width: 100%">
<tr>
<th>Employee</th>
<th>M</th>
<th>T</th>
<th>W</th>
<th>Th</th>
<th>F</th>
<th>Sat</th>
<th>Sun</th>
</tr>
{% if laboritems %}
{% for x in laboritems %}
<tr>
<td>
{% if x.ot == True %}
{% if x.employee %}
<b>OT-</b>{{x.employee}}
{% else %}
<b>OT-</b>Painter{{x.custom_employee}}
{% endif %}
{% else %}
{% if x.employee %}
{{x.employee}}
{% else %}
Painter{{x.custom_employee}}
{% endif %}
{% endif %}
</td>
<td>{{x.monday}}</td>
<td>{{x.tuesday}}</td>
<td>{{x.wednesday}}</td>
<td>{{x.thursday}}</td>
<td>{{x.friday}}</td>
<td>{{x.saturday}}</td>
<td>{{x.sunday}}</td>
</tr>
{% endfor %}
{% endif %}
</table>
</div>
<hr style="width:100%">
<div style="margin-top: 12px; margin-bottom: 12px;">
<div style="width:100%; font-weight: bold; margin-bottom: 12px;">MATERIAL</div>
<table>
<tr>
<th>Description</th>
<th>Quantity</th>
<th>Units</th>
</tr>
{% if materials %}
{% for x in materials %}
<tr>
<td>{{x.description}}</td>
<td>{{x.quantity}}</td>
<td>{{x.units}}</td>
</tr>
{% endfor %}
{% endif %}
</table>
</div>
<hr style="width:100%">
<div style="margin-top: 12px; margin-bottom: 12px;">
<div style="width:100%; font-weight: bold; margin-bottom: 12px;">EQUIPMENT</div>
<table>
<tr>
<th>Description</th>
<th>Quantity</th>
<th>Units</th>
</tr>
{% if equipment %}
{% for y in equipment %}
<tr>
<td>{{y.description}}</td>
<td>{{y.quantity}}</td>
<td>{{y.units}}</td>
</tr>
{% endfor %}
{% endif %}
</table>
</div>
<hr style="width:100%">
<div style="margin-top: 12px; margin-bottom: 12px;">
<div style="width:100%; font-weight: bold; margin-bottom: 12px;">Sundries</div>
<table>
<tr>
<th>Description</th>
<th>Quantity</th>
<th>Units</th>
</tr>
{% if sundries %}
{% for y in sundries %}
<tr>
<td>{{y.description}}</td>
<td>{{y.quantity}}</td>
<td>{{y.units}}</td>
</tr>
{% endfor %}
{% endif %}
</table>
</div>
<hr style="width:100%">
{% if status == 'NEW' %}
    <form action="{% url 'print_ticket' changeorder.id 'NEW' %}" method="post">
        <div>
        <div style="margin-bottom: 12px;"><b>Signature:</b></div>
        {% if signature.signature %}
            <img id="saveSignature" src="{{signature.signature}}" name="saveSignature" style="width: 300px; height: 100px"
            alt="Saved image png"/>
            <div><b>Name:</b>&nbsp;{{signature.name}}</div>
            <div><b>Date:</b>&nbsp;{{signature.date}}</div>
            <div><b>Comments:</b>&nbsp;{{signature.notes}}</div>
{% else %}
<div class="signature-wrapper">

    <div style="margin-bottom: 10px; font-size: 18px; font-weight: bold;">
        Signature (sign below):
    </div>

    <canvas id="newSignature" class="roundCorners"></canvas>

    <div style="font-size: 14px; color: #666; margin-top: 6px;">
        Use your finger or mouse to sign above
    </div>

    <img id="saveSignature"
         name="saveSignature"
         style="display:none; width:300px; height:100px;"
         alt="Saved image png"/>

    {% if not signature %}
    <div style="max-width:500px; margin-top:12px;">
        <button type="button"
                id="saveSignatureBtn"
                class="btn btn-primary btn-sm btn-block"
                onclick="signatureSave2()">
            Confirm signature
        </button>

        <button type="button"
                id="clearSignatureBtn"
                class="btn btn-warning btn-sm btn-block"
                onclick="signatureClear()">
            Clear signature
        </button>
    </div>
    {% endif %}
<div id="hide_until_signed">
    <div style="margin-top: 12px;">
        <label><b>Print Name:</b></label><br>
        <input style="width:300px" id="signatureName" name="signatureName"/>
        <input type="hidden" id="signatureValue" name="signatureValue"/>
    </div>

    <div style="margin-top:12px;">
        <label for="gc_notes" style="font-weight:bold;">Comments:</label>
        <textarea id="gc_notes"
                  name="gc_notes"
                  rows="4"
                  placeholder="Enter any comments hereâ€¦"></textarea>
    </div>
</div>
</div>
{% endif %}

            <div>___________________________________________</div>
            </div>
            <div style="width: 400px">{{changeorder.job_number.client}}</div>
            {% csrf_token %}
            <script>signatureCapture();</script>
{% if not signature %}
        <div id="hide_until_signed2">
<div style="max-width:500px; margin-top:20px;">
    <input
        type="submit"
        id="final_button"
        class="btn btn-danger btn-lg btn-block"
        value="Approve Time and Material">
</div>
        </div>
{% endif %}
            </div>
            </div>
    </form>
{% else %}
    <br>
    <div style="height: 150px"></div>
    <div>_______________________________________________________________</div>
    <div style="width: 400px">APPROVED BY - {{changeorder.job_number.client}}</div>
{% endif %}
</body>
</html>

