
<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
	<title>PROPOSAL</title>
	    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous"
      xmlns:margin-left="http://www.w3.org/1999/xhtml">

	<link rel="shortcut icon" type="image/png" href="/media/images/favicon.png">
	<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://www.datatables.net/rss.xml">
	<link rel="stylesheet" type="text/css" href="/media/css/site-examples.css?_=8f7cff5ee7757412879aedf3efbfaee01">

	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.2/css/jquery.dataTables.min.css">

	<style type="text/css" class="init">

	</style>
	<script type="text/javascript" src="/media/js/site.js?_=1d5abd169416a09a2b389885211721dd" data-domain="datatables.net" data-api="https://plausible.sprymedia.co.uk/api/event"></script>
	<script src="https://media.ethicalads.io/media/client/ethicalads.min.js"></script>
	<script type="text/javascript" src="/media/js/dynamic.php?comments-page=examples%2Fadvanced_init%2Fevents_live.html" async></script>
	<script type="text/javascript" src="/media/js/dynamic.php?comments-page=examples%2Fdata_sources%2Fdom.html" async></script>
	<script type="text/javascript" language="javascript" src="https://code.jquery.com/jquery-3.5.1.js"></script>
	<script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js"></script>
	<script type="text/javascript" language="javascript" src="../resources/demo.js"></script>
	<script type="text/javascript" class="init">
var laborcount = {{laborcount}}
var glob_materialcount= {{materialcount}}
var glob_equipmentcount= {{equipmentcount}}
var glob_extrascount = {{extrascount}}

function add_labor_row() {
	laborcount = laborcount + 1
	hidden = document.getElementById("hidden_labor");
	hidden.value=laborcount
	var table = document.getElementById("labor_breakdown");
	var rows = table.getElementsByTagName("tr").length
	var row = table.insertRow(rows-1);
	var cell1 = row.insertCell(0);
	var cell2 = row.insertCell(1);
	var cell3 = row.insertCell(2);
	var cell4 = row.insertCell(3);
	cell1.innerHTML = "<div id='new_labor" + laborcount + "'></div>";
	add_labor_dropdown()
	cell2.innerHTML ="<input type= 'number' name='labor_hours" + laborcount + "' id='labor_hours" + laborcount + "'  onchange ='changehours(event)' size='10' required />"
	cell3.innerHTML ="$<input type= 'number' name='labor_cost" + laborcount + "' id='labor_cost" + laborcount + "'  size='10' required />"
}

function add_labor_dropdown(){
		var select = document.createElement("select");
		var rate = 0.00
		select.name = "select_labor" + laborcount;
		select.id = "select_labor" + laborcount;
		select.addEventListener('change',function() {changelabor(event);},false);
		let rolodex = JSON.parse("{{employees_json|escapejs}}");
				var option = document.createElement("option");
		option.value = "please_select";
		option.text= "please select";
		select.appendChild(option);
				for (const x of rolodex)
		{
		var option = document.createElement("option");
		option.value = x.id;
		option.text= x.item;
		select.appendChild(option);
		}
		var label = document.createElement("label");
		document.getElementById("new_labor" + laborcount).appendChild(label).appendChild(select);
		var hidden_input = document.createElement("input");
		hidden_input.setAttribute("type", "hidden");
		hidden_input.setAttribute("name", "labor_rate" + laborcount);
		hidden_input.setAttribute("id", "labor_rate" + laborcount);
		hidden_input.setAttribute("value", 0);
		document.getElementById("new_labor" + laborcount).appendChild(hidden_input);
}
function changelabor(){
	clicked_row = event.currentTarget.id.substring(12,event.currentTarget.id.length)
	description = document.getElementById("labor_rate" + clicked_row)
	rolodex = JSON.parse("{{employees_json|escapejs}}");
	for(let i =0; i < rolodex.length; i++){
		if (rolodex[i].id == event.currentTarget.value){
			description.value = rolodex[i].rate
		}
	}
}
function changehours(){
	clicked_row = event.currentTarget.id.substring(11,event.currentTarget.id.length)
	rate = document.getElementById("labor_rate" + clicked_row)
	hours = document.getElementById("labor_hours" + clicked_row)
	total = document.getElementById("labor_cost" + clicked_row)
	total.value = hours.value * rate.value
	calculate_final_cost()
}


function add_material_row(type) {
	if (type == "material"){
		glob_materialcount=glob_materialcount+1
		materialcount = glob_materialcount
		hidden = document.getElementById("hidden_material");
		var table = document.getElementById("material_breakdown");
	}
	if (type == "equipment"){
		glob_equipmentcount=glob_equipmentcount+1
		materialcount = glob_equipmentcount
		hidden = document.getElementById("hidden_equipment");
		var table = document.getElementById("equipment_breakdown");
	}
	if (type == "extras"){
		glob_extrascount = glob_extrascount+1
		materialcount = glob_extrascount
		hidden = document.getElementById("hidden_extras");
		var table = document.getElementById("extras_breakdown");
	}
	hidden.value = materialcount
	var rows = table.getElementsByTagName("tr").length
		if (type == "material"){
		var row = table.insertRow(rows-2);
	}
	else {var row = table.insertRow(rows-1)}

	var cell1 = row.insertCell(0);
	var cell2 = row.insertCell(1);
	var cell3 = row.insertCell(2);
	var cell4 = row.insertCell(3);
	var cell5 = row.insertCell(4);
	cell1.innerHTML = "<div id='new_" + type + String(materialcount) + "'></div>";
	add_material_dropdown(type)
	cell2.innerHTML ="<input type= 'text' name='" + type + "_description"+ materialcount + "' id='" + type + "_description"+ materialcount + "'  size='30' required />"
	cell3.innerHTML ="<input type= 'number' name='" + type + "_quantity"+ materialcount + "' id='" + type + "_quantity"+ materialcount + "'  onchange = 'changequantity(event)' size='10' required />"
	cell4.innerHTML ="<input type= 'text' name='" + type + "_units"+ materialcount + "' id='" + type + "_units"+ materialcount + "'  size='7' required />"
	cell5.innerHTML ="$<input type= 'number' name='" + type + "_cost"+ materialcount + "' id='" + type + "_cost"+ materialcount + "'  size='7' required />"
}


function add_material_dropdown(type){
		var select = document.createElement("select");
		var rate = 0.00
		select.name = type + "_category" + String(materialcount);
		select.id = type + "_category" + String(materialcount);
		if (type == "material"){
			select.addEventListener('change',function() {changematerial(event);},false);
			rolodex = JSON.parse("{{material_json|escapejs}}");
		}
		if (type == "equipment"){
			select.addEventListener('change',function() {changeequipment(event);},false);
			rolodex = JSON.parse("{{equipment_json|escapejs}}");
		}
		if (type == "extras"){
			select.addEventListener('change',function() {changeextras(event);},false);
			rolodex = JSON.parse("{{extras_json|escapejs}}");
		}
		var option = document.createElement("option");
		option.value = "please_select";
		option.text= "please select";
		select.appendChild(option);
		for (const x of rolodex)
		{
		var option = document.createElement("option");
		option.value = x.id;
		option.text= x.item;
		select.appendChild(option);
		}
		var label = document.createElement("label");
		document.getElementById("new_"  + type + String(materialcount)).appendChild(label).appendChild(select);
		var hidden_input = document.createElement("input");
		hidden_input.setAttribute("type", "hidden");
		hidden_input.setAttribute("name", type + "_rate" + materialcount);
		hidden_input.setAttribute("id", type + "_rate" + materialcount);
		hidden_input.setAttribute("value", 0);
		document.getElementById("new_"  + type + String(materialcount)).appendChild(hidden_input);
}

function changematerial(){
	clicked_row = event.currentTarget.id.substring(17,event.currentTarget.id.length)
	description = document.getElementById("material_description" + clicked_row)
	rate = document.getElementById("material_rate" + clicked_row)
	unit = document.getElementById("material_units" + clicked_row)
	rolodex = JSON.parse("{{material_json|escapejs}}");
	for(let i =0; i < rolodex.length; i++){
		if (rolodex[i].id == event.currentTarget.value){
			description.value = rolodex[i].item
			rate.value = rolodex[i].rate
			unit.value = rolodex[i].unit
		}
	}
}

function changeequipment(){
	clicked_row = event.currentTarget.id.substring(18,event.currentTarget.id.length)
	description = document.getElementById("equipment_description" + clicked_row)
	rate = document.getElementById("equipment_rate" + clicked_row)
	unit = document.getElementById("equipment_units" + clicked_row)
	rolodex = JSON.parse("{{equipment_json|escapejs}}");
	for(let i =0; i < rolodex.length; i++){
		if (rolodex[i].id == event.currentTarget.value){
			description.value = rolodex[i].item
			rate.value = rolodex[i].rate
			unit.value = rolodex[i].unit
		}
	}
}

function changeextras(){
	clicked_row = event.currentTarget.id.substring(15,event.currentTarget.id.length)
	description = document.getElementById("extras_description" + clicked_row)
	rate = document.getElementById("extras_rate" + clicked_row)
	unit = document.getElementById("extras_units" + clicked_row)
	rolodex = JSON.parse("{{extras_json|escapejs}}");
	for(let i =0; i < rolodex.length; i++){
		if (rolodex[i].id == event.currentTarget.value){
			description.value = rolodex[i].item
			rate.value = rolodex[i].rate
			unit.value = rolodex[i].unit
		}
	}
}

function changequantity(){
	if (event.currentTarget.id.substring(0,17) == "material_quantity") {type = "material"; clicked_row = event.currentTarget.id.substring(17,event.currentTarget.id.length)}
	if (event.currentTarget.id.substring(0,18) == "equipment_quantity") {type = "equipment"; clicked_row = event.currentTarget.id.substring(18,event.currentTarget.id.length)}
	if (event.currentTarget.id.substring(0,15) == "extras_quantity") {type = "extras"; clicked_row = event.currentTarget.id.substring(15,event.currentTarget.id.length)}
	rate = document.getElementById(type + "_rate" + clicked_row)
	hours = document.getElementById(type + "_quantity" + clicked_row)
	total = document.getElementById(type + "_cost" + clicked_row)
	total.value = hours.value * rate.value
	calculate_final_cost()
}

function calculate_final_cost(){

	var finalcost = 0
	var materialcost = 0
	for(let i =1; i < laborcount+1; i++){
	finalcost = parseFloat(document.getElementById("labor_cost" + i).value) + finalcost
	}
	for(let i =1; i < glob_materialcount+1; i++){
	materialcost = parseFloat(document.getElementById("material_cost" + i).value) + materialcost
	finalcost = parseFloat(document.getElementById("material_cost" + i).value) + finalcost
	}
	document.getElementById("inventory_cost").value = materialcost *.15
	document.getElementById("inventory_cost_display").innerHTML = "$" + String(parseInt(materialcost *.15))
	for(let i =1; i < glob_equipmentcount+1; i++){
	finalcost = parseFloat(document.getElementById("equipment_cost" + i).value) + finalcost
	}
	for(let i =1; i < glob_extrascount+1; i++){
	finalcost = parseFloat(document.getElementById("extras_cost" + i).value) + finalcost
	}
	finalcost = finalcost + parseFloat(document.getElementById("inventory_cost").value)
	document.getElementById("bond_cost").value = finalcost * parseFloat({{bond_rate}})
	document.getElementById("bond_cost_display").innerHTML ="Bond Cost: $" + String(parseInt(document.getElementById("bond_cost").value))
	finalcost = finalcost + parseFloat(document.getElementById("bond_cost").value)
	document.getElementById("final_cost").value = parseInt(finalcost)
	document.getElementById("final_cost_display").innerHTML = "<b>Final Cost: $" + parseInt(finalcost) + "</b>"

}


	</script>
</head>
<body>
  <div class ="container">
	<div class ="row">
		<div class ="col"><H2>Gerloff Painting T&M Price Breakdown</H2></div>
	</div>
	<div class ="row">
		<div class ="col">Job: {{changeorder.job_number}}</div>
		<div class ="col">Change Order #{{changeorder.cop_number}} - {{changeorder.description}}</div>
	</div>
	<div class ="row">
		<div class ="col">Week Ending Date: {{ewt.week_ending}} </div>
		<div class ="col">Ticket Completed By: {{ewt.completed_by}}</div>
	</div>
	<div class ="row">
		<div class ="col"><p>Work Description: {{ewt.notes}}</p></div>
	</div>
  </div>
  <br><hr>

   <div class ="container">

            <div class ="row">
				<div class ="col">Description: {{newproposal.notes}}</div></div><br>
	   {% if laboritems %}
	   <div class ="row">
	   <div class ="col-3"><b>Labor Breakdown</b></div>

		 <div class ="col-2"><b>Quantity</b></div>
		    <div class ="col-2"><b>Units</b></div>
		   <div class ="col-2"><b>Cost</b></div>  </div>

	   {% for x in laboritems %}
	   <div class ="row">
			   <div class ="col-3">{{x.description}}</div>

		 <div class ="col-2">{{x.quantity}}</div>
		   <div class ="col-2">Hours</div>
		   <div class ="col-2">${{x.total}}</div>  </div>
		{% endfor %}
	   {% endif %}

	   	   {% if materialitems %}
<br>
	   <div class ="row">
	   <div class ="col-3"><b>Material</b></div>
		 <div class ="col-2"><b>Quantity</b></div>
		   <div class ="col-2"><b>Units</b></div>
		   <div class ="col-2"><b>Cost</b></div>  </div>

	   {% for x in materialitems %}
	   <div class ="row">
			   <div class ="col-3">{{x.category2}} {{x.description}} </div>
		 <div class ="col-2">{{x.quantity}}</div>
		   <div class ="col-2">{{x.units}}</div>
		   <div class ="col-2">${{x.total}}</div>  </div>
		{% endfor %}
	   {% if inventory_exists == True %}
	   	   <div class ="row">
			   <div class ="col-3">Inventory </div>
		 <div class ="col-2">1</div>
		   <div class ="col-2">LS</div>
		   <div class ="col-2">${{inventory.total}}</div>  </div>
	   {% endif %}
	   {% endif %}

	   	   {% if equipmentitems %}
	   <br>
	   <div class ="row">
	   <div class ="col-3"><b>Equipment</b></div>
		 <div class ="col-2"><b>Quantity</b></div>
		   <div class ="col-2"><b>Units</b></div>
		   <div class ="col-2"><b>Cost</b></div>  </div>

	   {% for x in equipmentitems %}
	   <div class ="row">
			   <div class ="col-3">{{x.category2}} {{x.description}} </div>
		 <div class ="col-2">{{x.quantity}}</div>
		   <div class ="col-2">{{x.units}}</div>
		   <div class ="col-2">${{x.total}}</div>  </div>
		{% endfor %}
{% endif %}
	   	   {% if extraitems %}
	   <br>
	   <div class ="row">
	   <div class ="col-3"><b>Extra Item</b></div>
		 <div class ="col-2"><b>Quantity</b></div>
		   <div class ="col-2"><b>Units</b></div>
		   <div class ="col-2"><b>Cost</b></div>  </div>

	   {% for x in extraitems %}
	   <div class ="row">
			   <div class ="col-3">{{x.category2}} {{x.description}} </div>
		 <div class ="col-2">{{x.quantity}}</div>
		   <div class ="col-2">{{x.units}}</div>
		   <div class ="col-2">${{x.total}}</div>  </div>
		{% endfor %}
	   {% if bond_exists == True %}
	   	   <div class ="row">
			   <div class ="col-3">Bond </div>
		 <div class ="col-2">1</div>
		   <div class ="col-2">LS</div>
		   <div class ="col-2">${{bond.total}}</div>  </div>
	   {% endif %}
	   {% endif %}
	   <br><hr>
		<div class ="row">
			<div class ="col-2"> </div>
			<div class ="col-3"><h4>TOTAL:</h4> </div>
			<div class ="col-2"><h4>${{newproposal.total}}</h4> </div>
		</div>
	   <div class ="row">
	   			 <form action="{% url 'extra_work_ticket' changeorder.id %}"   >

<input type="submit"  value="SEND NOW" />
			 </form>

	   </div>
   </div>


<script src=”https://code.jquery.com/jquery-3.2.1.slim.min.js” integrity=”sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN” crossorigin=”anonymous”></script>

<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js integrity=”sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q” crossorigin=”anonymous”></script>

<script src=”https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js” integrity=”sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl” crossorigin=”anonymous”></script>
</body>
</html>

